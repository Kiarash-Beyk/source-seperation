<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Source Separation Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/js/main.js"></script>


</head>
<body x-data="folderBrowser()" class=" bg-gray-100 flex flex-col items-center justify-center min-h-screen">

<div  class="w-full bg-white shadow-lg rounded-lg p-6 m-2 w-full max-w-lg">
    <h1 class="text-2xl font-bold mb-4 text-center">Source Separation</h1>

    <!-- File Input -->
    <input type="file" @change="fileChosen" class="mb-4 block w-full text-sm text-gray-700 border rounded p-2">

    <!-- Upload Button -->
    <button 
        type="button"
        @click="uploadFile"
        :disabled="!file"
        class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:bg-gray-400">
        seperatte
    </button>

    <!-- Status -->
    <div  class="mt-4 text-center" x-show="seperationStatus">
        <p x-text="seperationStatus"></p>
    </div>

</div>


    <!-- folder section -->
<div  class="flex flex-col items-center mt-4">

    <div class="flex flex-row items-center justify-center mb-4">

        <button @click="getFolders"
            class="p-2 mr-2 bg-blue-500 text-white rounded-lg shadow hover:bg-blue-600">
            Refresh
        </button>

        <select 
            x-model="selectedFolder"
            @change="cacheStems"
            class="max-w-[375px] p-2 border rounded-lg bg-white shadow focus:outline-none focus:ring-2 focus:ring-blue-500 :disabled: bg-blue-300"
        >
            <option value="" class="text-center ">--------- Select a Folder ---------</option>
            <template x-for="f in test_folders" :key="f">
                <option :value="f" x-text="f"></option>
                
            </template>
        </select>
    </div>


    <div class="w-full bg-white shadow-lg rounded-lg p-6 space-y-6">

    <!-- Play / Pause + Timeline -->
    <div class="flex items-center space-x-3">
        <button 
        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition disabled:bg-blue-300"
        @click="playAll"
        :disabled="Object.keys(stemsAudioBuffer).length <4"
        >
        Play
        </button>
        <button 
        class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition  disabled:bg-gray-400"
        @click="pauseAll"
        :disabled="Object.keys(stemsAudioBuffer).length <4"
        >
        Pause
        </button>


        <!-- Master Volume -->

        <input 
        type="range" 
        min="0" 
        max="1" 
        step="0.01" 
        x-model="masterVolume" 
        @input="updateMasterVolume($event.target.value)"
        class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
        >
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-9">
  <path stroke-linecap="round" stroke-linejoin="round" d="M19.114 5.636a9 9 0 0 1 0 12.728M16.463 8.288a5.25 5.25 0 0 1 0 7.424M6.75 8.25l4.72-4.72a.75.75 0 0 1 1.28.53v15.88a.75.75 0 0 1-1.28.53l-4.72-4.72H4.51c-.88 0-1.704-.507-1.938-1.354A9.009 9.009 0 0 1 2.25 12c0-.83.112-1.633.322-2.396C2.806 8.756 3.63 8.25 4.51 8.25H6.75Z" />
</svg>
    </div>

        <!-- Timeline Slider -->
    <div class="flex items-center space-x-3">
        <span x-text=" `${formatTime(currentTime)} `"></span>

            <input 
        type="range" 
        min="0" 
        :max="duration" 
        step="0.1" 
        x-model="currentTime"
        @mousedown="seekStart()"
        @input="seekTo($event.target.value)"
        @mouseup="seekEnd()"
        @touchstart="seekStart()"
        @touchend="seekEnd()"
        class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-red-500"
        >
        <span x-text=" `${formatTime(duration)} `"></span>



    </div>

    <!-- Instrument Volume Controls -->
    <div class="space-y-3">
        <template x-for="ins in instruments" :key="ins">
        <div class="flex items-center justify-between bg-gray-50 p-3 rounded-lg shadow-sm">
            <div class="font-medium text-gray-700 w-24" x-text="ins"></div>
            
            <input 
            type="range" 
            min="0" 
            max="1" 
            step="0.01" 
            x-model="volumes[ins]"
            @input="updateVolume(ins, $event.target.value)"
            class="flex-1 mx-4 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
            >
            
            <span class="text-sm text-gray-600 w-12 text-right" 
            x-text="(volumes[ins] * 100).toFixed(0) + '%'">
            </span>
            
            <button 
            @click="muteVolume(ins)" 
            class="ml-3 px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition"
            >
            Mute
            </button>
            <button 
                @click="downloadStem(ins)" 
                class="ml-3 px-3 py-1 bg-white text-sm rounded hover:text-blue-700 transition"
                title="Download this stem"
                :disabled="!selectedFolder"
                :class="{ 'opacity-50 cursor-not-allowed': !selectedFolder }"
            >
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                </svg>
            </button>
        </div>
        </template>
    </div>

    <div 
        x-show="catchStatus"  
        class="fixed bottom-4 left-4 text-sm text-red-700 bg-white shadow-lg px-3 py-2 rounded"
    >
        <p x-text="catchStatus"></p>
    </div>
    </div>

</div>


            


</body>

</html>
